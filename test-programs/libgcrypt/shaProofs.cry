include "SHA384-Ops.cry";
msg_len = 1;

sha384_top : [msg_len][8] -> [384];
sha384_top msg = join (reverse(bytes))
  where {
      bytes : [48][8];
      bytes = split (sha384(msg));
  };

extern AIG sha384_gcrypt_Transform("impl_AIGs/Transform.aig") : ([8][64], [16][64]) -> [8][64];
extern AIG sha384_ref_Transform("spec_AIGs/Transform.aig"): ([8][64], [16][64]) -> [8][64];

sha384_ref_Transform_Wrapped (hs, data) = sha384_gcrypt_Transform (hs, data')
    where {
      data' = [| join (reverse (splitBy(8, d))) || d <- data |];
    };

theorem sha384_Transform_eq : {hs data}. 
    sha384_gcrypt_Transform (hs, data) == sha384_ref_Transform (hs, data')
    where {
      data' = [| join (reverse (splitBy(8, d))) || d <- data |];
    };

extern AIG sha384_ref_block512("spec_AIGs/block512.aig") : ([8][64], [16][64]) -> [8][64];
theorem block512s_eq : {x}. sha384_ref_block512(x) == sha384_ref_Transform(x);
pragma block512 : SBV assumeEquals sha384_ref_Transform_Wrapped;

